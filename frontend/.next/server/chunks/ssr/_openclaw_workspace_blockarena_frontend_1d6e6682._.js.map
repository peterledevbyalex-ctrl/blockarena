{"version":3,"sources":["../../../../../../../../.openclaw/workspace/blockarena/frontend/lib/api.ts","../../../../../../../../.openclaw/workspace/blockarena/frontend/hooks/useApi.ts","../../../../../../../../.openclaw/workspace/blockarena/frontend/app/leaderboard/page.tsx"],"sourcesContent":["/**\n * Backend API client for BlockArena.\n * Falls back gracefully when backend is unavailable.\n */\n\nconst API_BASE = process.env.NEXT_PUBLIC_API_URL || 'http://localhost:3001';\nconst WS_URL = process.env.NEXT_PUBLIC_WS_URL || 'ws://localhost:3001';\n\nexport interface ApiArena {\n  id: number;\n  tier: number; // 0=Low, 1=Mid, 2=High, 3=VIP\n  startBlock: number;\n  endBlock: number;\n  pot: string;\n  playerCount: number;\n  finalized: boolean;\n  players: string[];\n  tournamentId: number;\n}\n\nexport interface ApiPlayerStats {\n  address: string;\n  wins: number;\n  losses: number;\n  totalPnL: string;\n  bestStreak: number;\n  currentStreak: number;\n  arenasPlayed: number;\n}\n\nexport interface ApiLeaderboardEntry {\n  address: string;\n  wins: number;\n  streak: number;\n  totalPnL: string;\n}\n\nexport interface ApiPriceUpdate {\n  type: 'price';\n  arenaId: number;\n  block: number;\n  price: string;\n}\n\nexport interface ApiArenaUpdate {\n  type: 'arena';\n  arenaId: number;\n  event: string;\n  data: Record<string, unknown>;\n}\n\ntype WsMessage = ApiPriceUpdate | ApiArenaUpdate;\n\nasync function apiFetch<T>(path: string): Promise<T | null> {\n  try {\n    const res = await fetch(`${API_BASE}${path}`);\n    if (!res.ok) return null;\n    return await res.json();\n  } catch {\n    return null;\n  }\n}\n\nexport async function fetchArenas(): Promise<ApiArena[]> {\n  return (await apiFetch<ApiArena[]>('/arenas')) ?? [];\n}\n\nexport async function fetchArena(id: number): Promise<ApiArena | null> {\n  return apiFetch<ApiArena>(`/arenas/${id}`);\n}\n\nexport async function fetchPlayerStats(address: string): Promise<ApiPlayerStats | null> {\n  return apiFetch<ApiPlayerStats>(`/players/${address}`);\n}\n\nexport async function fetchLeaderboard(): Promise<ApiLeaderboardEntry[]> {\n  return (await apiFetch<ApiLeaderboardEntry[]>('/leaderboard')) ?? [];\n}\n\n/**\n * Connect to WebSocket for live updates.\n * Implements keepalive ping every 30s to prevent disconnection\n * (MegaETH WS endpoints require periodic activity).\n */\nexport function connectWebSocket(\n  onMessage: (msg: WsMessage) => void,\n  onError?: () => void,\n): () => void {\n  let ws: WebSocket | null = null;\n  let closed = false;\n  let keepalive: ReturnType<typeof setInterval> | null = null;\n\n  function connect() {\n    if (closed) return;\n    try {\n      ws = new WebSocket(WS_URL);\n\n      ws.onopen = () => {\n        // MegaETH keepalive: ping every 30 seconds to prevent disconnection\n        keepalive = setInterval(() => {\n          if (ws && ws.readyState === WebSocket.OPEN) {\n            ws.send(JSON.stringify({ type: 'ping' }));\n          }\n        }, 30_000);\n      };\n\n      ws.onmessage = (e) => {\n        try {\n          onMessage(JSON.parse(e.data));\n        } catch { /* ignore */ }\n      };\n      ws.onclose = () => {\n        if (keepalive) { clearInterval(keepalive); keepalive = null; }\n        if (!closed) setTimeout(connect, 3000);\n      };\n      ws.onerror = () => {\n        onError?.();\n        ws?.close();\n      };\n    } catch {\n      if (!closed) setTimeout(connect, 3000);\n    }\n  }\n\n  connect();\n\n  return () => {\n    closed = true;\n    if (keepalive) { clearInterval(keepalive); keepalive = null; }\n    ws?.close();\n  };\n}\n","'use client';\n\nimport { useState, useEffect, useCallback, useRef } from 'react';\nimport {\n  fetchArenas,\n  fetchArena,\n  fetchPlayerStats,\n  fetchLeaderboard,\n  connectWebSocket,\n  type ApiArena,\n  type ApiPlayerStats,\n  type ApiLeaderboardEntry,\n  type ApiPriceUpdate,\n} from '@/lib/api';\n\n/** Fetch arena list from backend API */\nexport function useApiArenas() {\n  const [arenas, setArenas] = useState<ApiArena[]>([]);\n  const [loading, setLoading] = useState(true);\n\n  const refresh = useCallback(async () => {\n    const data = await fetchArenas();\n    setArenas(data);\n    setLoading(false);\n  }, []);\n\n  useEffect(() => {\n    refresh();\n    const interval = setInterval(refresh, 10_000);\n    return () => clearInterval(interval);\n  }, [refresh]);\n\n  return { arenas, loading, refresh };\n}\n\n/** Fetch single arena from backend API */\nexport function useApiArena(id: number) {\n  const [arena, setArena] = useState<ApiArena | null>(null);\n\n  useEffect(() => {\n    fetchArena(id).then(setArena);\n  }, [id]);\n\n  return arena;\n}\n\n/** Fetch player stats from backend API */\nexport function useApiPlayerStats(address?: string) {\n  const [stats, setStats] = useState<ApiPlayerStats | null>(null);\n\n  useEffect(() => {\n    if (!address) return;\n    fetchPlayerStats(address).then(setStats);\n  }, [address]);\n\n  return stats;\n}\n\n/** Fetch leaderboard from backend API */\nexport function useApiLeaderboard() {\n  const [entries, setEntries] = useState<ApiLeaderboardEntry[]>([]);\n\n  useEffect(() => {\n    fetchLeaderboard().then(setEntries);\n  }, []);\n\n  return entries;\n}\n\n/** Subscribe to live price updates via WebSocket */\nexport function useLivePrices(arenaId?: number) {\n  const [prices, setPrices] = useState<{ block: number; price: string }[]>([]);\n  const [connected, setConnected] = useState(false);\n\n  useEffect(() => {\n    const cleanup = connectWebSocket(\n      (msg) => {\n        if (msg.type === 'price' && (arenaId === undefined || msg.arenaId === arenaId)) {\n          setPrices((prev) => [...prev.slice(-499), { block: (msg as ApiPriceUpdate).block, price: (msg as ApiPriceUpdate).price }]);\n        }\n      },\n      () => setConnected(false),\n    );\n    setConnected(true);\n    return cleanup;\n  }, [arenaId]);\n\n  return { prices, connected };\n}\n","'use client';\n\nimport { useApiLeaderboard } from '@/hooks/useApi';\nimport { useWallet } from '@/hooks/useWallet';\nimport { ConnectWallet } from '@/components/ConnectWallet';\nimport { motion } from 'framer-motion';\n\nconst MOCK_LEADERBOARD = Array.from({ length: 20 }, (_, i) => ({\n  address: `0x${(i + 1).toString(16).padStart(40, 'a')}`,\n  wins: 50 - i * 2,\n  streak: Math.max(0, 15 - i),\n  totalPnL: `${(5 - i * 0.3).toFixed(2)}`,\n}));\n\nexport default function LeaderboardPage() {\n  const entries = useApiLeaderboard();\n  const { address } = useWallet();\n  const data = entries.length > 0 ? entries : MOCK_LEADERBOARD;\n\n  const getMedal = (i: number) => {\n    if (i === 0) return 'ü•á';\n    if (i === 1) return 'ü•à';\n    if (i === 2) return 'ü•â';\n    return `#${i + 1}`;\n  };\n\n  return (\n    <main className=\"max-w-4xl mx-auto px-4 py-6\">\n      <div className=\"flex justify-between items-center mb-6\">\n        <h1 className=\"font-display text-2xl font-bold neon-text-purple\">üèÜ LEADERBOARD</h1>\n        <ConnectWallet />\n      </div>\n\n      {/* Top 3 podium */}\n      <div className=\"flex justify-center items-end gap-3 mb-8\">\n        {[1, 0, 2].map((idx) => {\n          const entry = data[idx];\n          if (!entry) return null;\n          const isFirst = idx === 0;\n          return (\n            <motion.div\n              key={idx}\n              initial={{ opacity: 0, y: 30 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: idx * 0.15 }}\n              className={`text-center ${isFirst ? 'order-2' : idx === 1 ? 'order-1' : 'order-3'}`}\n            >\n              <div className={`text-3xl mb-1 ${isFirst ? 'animate-celebration' : ''}`}>{getMedal(idx)}</div>\n              <div className={`glass-card rounded-xl p-3 border ${\n                isFirst ? 'border-yellow-500/30 shadow-[0_0_20px_rgba(255,215,0,0.15)]' :\n                idx === 1 ? 'border-gray-400/20' : 'border-orange-600/20'\n              } ${isFirst ? 'w-28' : 'w-24'}`}>\n                <div className=\"font-mono text-xs text-gray-400 truncate\">{entry.address.slice(0, 6)}...{entry.address.slice(-4)}</div>\n                <div className=\"font-display text-lg font-bold text-white mt-1\">{entry.wins}W</div>\n                <div className={`text-xs font-bold ${parseFloat(entry.totalPnL) >= 0 ? 'neon-text-green' : 'neon-text-red'}`}>\n                  {parseFloat(entry.totalPnL) >= 0 ? '+' : ''}{entry.totalPnL} ETH\n                </div>\n                {entry.streak > 0 && (\n                  <div className=\"text-xs text-orange-400 mt-0.5\">üî• {entry.streak}x</div>\n                )}\n              </div>\n            </motion.div>\n          );\n        })}\n      </div>\n\n      {/* Full list */}\n      <div className=\"space-y-1.5\">\n        {data.map((entry, i) => {\n          const isYou = address?.toLowerCase() === entry.address.toLowerCase();\n          return (\n            <motion.div\n              key={i}\n              initial={{ opacity: 0, x: -20 }}\n              animate={{ opacity: 1, x: 0 }}\n              transition={{ delay: i * 0.03 }}\n              className={`flex items-center justify-between p-3 rounded-xl transition-all ${\n                isYou\n                  ? 'glass-card border border-purple-500/30 shadow-[0_0_15px_rgba(139,92,246,0.15)]'\n                  : 'hover:bg-white/3'\n              }`}\n            >\n              <div className=\"flex items-center gap-3\">\n                <span className={`font-display text-sm font-bold w-8 text-center ${\n                  i < 3 ? 'text-yellow-400' : 'text-gray-600'\n                }`}>\n                  {i < 3 ? getMedal(i) : `${i + 1}`}\n                </span>\n                <span className=\"font-mono text-sm text-gray-300\">\n                  {entry.address.slice(0, 6)}...{entry.address.slice(-4)}\n                  {isYou && <span className=\"ml-2 text-purple-400 text-xs font-bold\">(YOU)</span>}\n                </span>\n              </div>\n              <div className=\"flex items-center gap-4\">\n                {entry.streak >= 3 && (\n                  <span className=\"text-xs text-orange-400 font-bold\">üî•{entry.streak}</span>\n                )}\n                <span className=\"font-display text-sm font-bold text-white\">{entry.wins}W</span>\n                <span className={`font-display text-sm font-bold ${\n                  parseFloat(entry.totalPnL) >= 0 ? 'neon-text-green' : 'neon-text-red'\n                }`}>\n                  {parseFloat(entry.totalPnL) >= 0 ? '+' : ''}{entry.totalPnL}\n                </span>\n              </div>\n            </motion.div>\n          );\n        })}\n      </div>\n    </main>\n  );\n}\n"],"names":[],"mappings":"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"}